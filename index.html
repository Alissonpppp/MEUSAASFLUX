<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FluxBlue Pro - Gestão Inteligente</title>
    
    <!-- Core: React, ReactDOM, Babel, Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Dependência: Prop-types (Necessário para Recharts UMD) -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>

    <!-- Charts: Recharts (Versão Fixa 2.8.0 para estabilidade) -->
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: { 
                        brand: { 50: '#f0f9ff', 100: '#e0f2fe', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1', 900: '#0c4a6e' },
                        dark: { 800: '#1e293b', 900: '#0f172a' }
                    }
                }
            }
        }
    </script>
    <style>
        /* Estilização extra para scrollbars e inputs */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .glass-panel { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        // Garantindo que Recharts está carregado antes de desestruturar
        const { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, AreaChart, Area } = window.Recharts || {};

        // --- ÍCONES (Lucide Style) ---
        const Icons = {
            Home: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            TrendingUp: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
            TrendingDown: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg>,
            FileText: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>,
            Upload: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>,
            Bot: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/><line x1="8" y1="16" x2="8" y2="16"/><line x1="16" y1="16" x2="16" y2="16"/><path d="M12 16v4"/><line x1="16" y1="11" x2="16" y2="7"/><line x1="8" y1="11" x2="8" y2="7"/></svg>,
            LogOut: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
            Key: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21 2-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>,
            Alert: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>,
            Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
        };

        // --- SISTEMA DB (LocalStorage) ---
        const DB_KEY = 'fluxblue_license_db';
        const APP_DATA_KEY = 'fluxblue_client_data'; // Separando dados da app da licença

        const ClientSystem = {
            init: () => {
                // Inicia DB de Licença se não existir
                if (!localStorage.getItem(DB_KEY)) {
                    localStorage.setItem(DB_KEY, JSON.stringify({ keys: [], clientData: [] }));
                }
                // Inicia DB de Dados do Usuário (Transações, Arquivos)
                if (!localStorage.getItem(APP_DATA_KEY)) {
                    // Seed Data para ficar bonito na primeira vez
                    const seedTransactions = [
                        { id: 1, type: 'income', desc: 'Venda de Software', amount: 5000, date: '2023-10-01', category: 'Vendas' },
                        { id: 2, type: 'expense', desc: 'Servidor AWS', amount: 450, date: '2023-10-05', category: 'Infra' },
                        { id: 3, type: 'expense', desc: 'Marketing Ads', amount: 1200, date: '2023-10-10', category: 'Marketing' },
                    ];
                    localStorage.setItem(APP_DATA_KEY, JSON.stringify({ 
                        transactions: seedTransactions, 
                        uploads: [] 
                    }));
                }
            },
            // Validação de Licença (Mantida do anterior)
            validateAndLogin: (email, inputKey) => {
                const db = JSON.parse(localStorage.getItem(DB_KEY));
                const licenseIndex = db.keys.findIndex(k => k.key === inputKey);

                if (licenseIndex === -1) return { success: false, msg: 'Chave inválida.' };

                const license = db.keys[licenseIndex];
                if (new Date() > new Date(license.expires)) return { success: false, msg: 'Licença expirada.' };

                if (!license.assignedEmail) {
                    license.assignedEmail = email;
                    license.status = 'active';
                    db.keys[licenseIndex] = license;
                    localStorage.setItem(DB_KEY, JSON.stringify(db));
                    return { success: true, license };
                } else if (license.assignedEmail !== email) {
                    return { success: false, msg: 'Chave já usada por outro e-mail.' };
                }
                return { success: true, license };
            },
            // Métodos de Dados da Aplicação
            getData: () => JSON.parse(localStorage.getItem(APP_DATA_KEY)),
            addTransaction: (trans) => {
                const db = JSON.parse(localStorage.getItem(APP_DATA_KEY));
                db.transactions.push({ ...trans, id: Date.now() + Math.random() });
                localStorage.setItem(APP_DATA_KEY, JSON.stringify(db));
                return db.transactions;
            },
            deleteTransaction: (id) => {
                const db = JSON.parse(localStorage.getItem(APP_DATA_KEY));
                db.transactions = db.transactions.filter(t => t.id !== id);
                localStorage.setItem(APP_DATA_KEY, JSON.stringify(db));
                return db.transactions;
            },
            addUpload: (fileMeta) => {
                const db = JSON.parse(localStorage.getItem(APP_DATA_KEY));
                db.uploads.push({ ...fileMeta, id: Date.now(), date: new Date().toISOString() });
                localStorage.setItem(APP_DATA_KEY, JSON.stringify(db));
                return db.uploads;
            }
        };

        // --- COMPONENTES DA UI ---

        // 1. LOGIN SCREEN
        const LoginScreen = ({ onLoginSuccess }) => {
            const [email, setEmail] = useState('');
            const [key, setKey] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);
                setTimeout(() => {
                    const result = ClientSystem.validateAndLogin(email.trim(), key.trim());
                    if (result.success) onLoginSuccess(result.license, email);
                    else { setError(result.msg); setLoading(false); }
                }, 800);
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 to-slate-200 p-4">
                    <div className="max-w-md w-full bg-white rounded-2xl shadow-2xl p-8 border border-white/50 backdrop-blur-sm">
                        <div className="text-center mb-8">
                            <div className="bg-brand-50 w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 text-brand-600">
                                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                            </div>
                            <h1 className="text-3xl font-bold text-slate-800">FluxBlue <span className="text-brand-600">Pro</span></h1>
                            <p className="text-slate-500">Gestão Financeira & IA</p>
                        </div>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-xs font-bold uppercase text-slate-500 mb-1">E-mail</label>
                                <input required type="email" className="w-full bg-slate-50 border border-slate-200 rounded-lg px-4 py-3 outline-none focus:ring-2 focus:ring-brand-500 transition" value={email} onChange={e => setEmail(e.target.value)} placeholder="voce@empresa.com" />
                            </div>
                            <div>
                                <label className="block text-xs font-bold uppercase text-slate-500 mb-1">Chave de Acesso</label>
                                <div className="relative">
                                    <span className="absolute left-4 top-3.5 text-slate-400"><Icons.Key /></span>
                                    <input required type="text" className="w-full bg-slate-50 border border-slate-200 rounded-lg pl-12 pr-4 py-3 font-mono text-sm outline-none focus:ring-2 focus:ring-brand-500 transition uppercase" value={key} onChange={e => setKey(e.target.value)} placeholder="FLUX-XXXX-XXXX" />
                                </div>
                            </div>
                            {error && <div className="bg-red-50 text-red-600 p-3 rounded-lg text-sm flex items-center gap-2 border border-red-100"><Icons.Alert /> {error}</div>}
                            <button type="submit" disabled={loading} className="w-full bg-brand-600 hover:bg-brand-700 text-white font-bold py-3.5 rounded-lg shadow-lg shadow-brand-500/30 transition-all transform hover:scale-[1.02]">{loading ? 'Validando...' : 'Entrar no Sistema'}</button>
                        </form>
                    </div>
                </div>
            );
        };

        // 2. IA CARD (Simulada)
        const AIInsight = ({ transactions }) => {
            const insight = useMemo(() => {
                const totalIncome = transactions.filter(t => t.type === 'income').reduce((acc, t) => acc + Number(t.amount), 0);
                const totalExpense = transactions.filter(t => t.type === 'expense').reduce((acc, t) => acc + Number(t.amount), 0);
                const balance = totalIncome - totalExpense;
                const ratio = totalIncome > 0 ? (totalExpense / totalIncome) * 100 : 0;

                if (totalIncome === 0 && totalExpense === 0) return "Olá! Comece adicionando suas receitas e despesas para que eu possa gerar análises inteligentes sobre seu negócio.";
                if (balance < 0) return `⚠️ Alerta Crítico: Seu fluxo de caixa está negativo em R$ ${Math.abs(balance).toFixed(2)}. Suas despesas superam suas receitas em ${ratio.toFixed(0)}%. Recomendo revisar custos fixos imediatamente.`;
                if (ratio > 80) return "⚠️ Atenção: Sua margem de lucro está apertada (<20%). Tente renegociar dívidas parceladas ou aumentar o ticket médio.";
                return `✅ Ótimo trabalho! Sua saúde financeira está estável. Você está poupando ${(100 - ratio).toFixed(0)}% da receita. Considere investir o excedente de R$ ${balance.toFixed(2)} em marketing.`;
            }, [transactions]);

            return (
                <div className="bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-6 rounded-2xl shadow-lg mb-6 flex items-start gap-4">
                    <div className="bg-white/20 p-3 rounded-xl backdrop-blur-sm"><Icons.Bot /></div>
                    <div>
                        <h3 className="font-bold text-lg mb-1">FluxBlue AI</h3>
                        <p className="text-indigo-100 text-sm leading-relaxed">{insight}</p>
                    </div>
                </div>
            );
        };

        // 3. DASHBOARD MAIN APP
        const Dashboard = ({ user, license, onLogout }) => {
            const [view, setView] = useState('overview'); // overview, finances, files
            const [data, setData] = useState({ transactions: [], uploads: [] });
            
            // Estados do Formulário
            const [formType, setFormType] = useState('income');
            const [desc, setDesc] = useState('');
            const [amount, setAmount] = useState('');
            const [installments, setInstallments] = useState(1);
            const [hasInstallments, setHasInstallments] = useState(false);

            useEffect(() => {
                const loaded = ClientSystem.getData();
                setData(loaded);
            }, []);

            // Lógica de adicionar transação (com parcelas)
            const handleAddTransaction = (e) => {
                e.preventDefault();
                const baseAmount = parseFloat(amount);
                const count = hasInstallments ? parseInt(installments) : 1;
                const installmentValue = baseAmount / count;
                const today = new Date();

                let newTrans = [];
                for (let i = 0; i < count; i++) {
                    const date = new Date(today);
                    date.setMonth(today.getMonth() + i);
                    
                    newTrans.push({
                        type: formType,
                        desc: count > 1 ? `${desc} (${i+1}/${count})` : desc,
                        amount: installmentValue.toFixed(2),
                        date: date.toISOString().split('T')[0],
                        category: 'Geral'
                    });
                }

                // Salva todas as parcelas
                let updatedList;
                newTrans.forEach(t => {
                    updatedList = ClientSystem.addTransaction(t);
                });
                
                setData(prev => ({ ...prev, transactions: updatedList }));
                setDesc(''); setAmount(''); setInstallments(1); setHasInstallments(false);
                alert(`${count} lançamento(s) adicionado(s) com sucesso!`);
            };

            const handleDelete = (id) => {
                if(confirm('Tem certeza?')) {
                    const updated = ClientSystem.deleteTransaction(id);
                    setData(prev => ({ ...prev, transactions: updated }));
                }
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const updated = ClientSystem.addUpload({ name: file.name, type: file.type, size: file.size });
                    setData(prev => ({ ...prev, uploads: updated }));
                }
            };

            // Cálculos para Gráficos
            const chartData = useMemo(() => {
                // Agrupar por mês
                const groups = {};
                data.transactions.forEach(t => {
                    const month = t.date.slice(0, 7); // YYYY-MM
                    if (!groups[month]) groups[month] = { name: month, receita: 0, despesa: 0, lucro: 0 };
                    if (t.type === 'income') groups[month].receita += parseFloat(t.amount);
                    else groups[month].despesa += parseFloat(t.amount);
                });
                return Object.values(groups).map(g => ({ ...g, lucro: g.receita - g.despesa })).sort((a,b) => a.name.localeCompare(b.name));
            }, [data.transactions]);

            return (
                <div className="flex min-h-screen bg-slate-50">
                    {/* SIDEBAR */}
                    <aside className="w-64 bg-dark-900 text-slate-300 flex-shrink-0 hidden md:flex flex-col">
                        <div className="p-6 border-b border-slate-800">
                            <h2 className="text-2xl font-bold text-white tracking-tight">FluxBlue</h2>
                            <p className="text-xs text-slate-500 mt-1">Enterprise Edition</p>
                        </div>
                        <nav className="flex-1 p-4 space-y-2">
                            <button onClick={() => setView('overview')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition ${view === 'overview' ? 'bg-brand-600 text-white shadow-lg shadow-brand-900/50' : 'hover:bg-slate-800'}`}>
                                <Icons.Home /> Dashboard
                            </button>
                            <button onClick={() => setView('finances')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition ${view === 'finances' ? 'bg-brand-600 text-white shadow-lg shadow-brand-900/50' : 'hover:bg-slate-800'}`}>
                                <Icons.TrendingUp /> Financeiro
                            </button>
                            <button onClick={() => setView('files')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition ${view === 'files' ? 'bg-brand-600 text-white shadow-lg shadow-brand-900/50' : 'hover:bg-slate-800'}`}>
                                <Icons.FileText /> Documentos
                            </button>
                        </nav>
                        <div className="p-4 border-t border-slate-800">
                            <div className="bg-slate-800 p-3 rounded-lg mb-3">
                                <p className="text-xs text-slate-400">Licença: {license.label}</p>
                                <p className="text-xs text-brand-400 truncate">{user}</p>
                            </div>
                            <button onClick={onLogout} className="flex items-center gap-2 text-sm text-red-400 hover:text-red-300 w-full justify-center"><Icons.LogOut /> Sair</button>
                        </div>
                    </aside>

                    {/* MAIN CONTENT */}
                    <main className="flex-1 p-4 md:p-8 overflow-y-auto h-screen">
                        
                        {/* Header Mobile */}
                        <div className="md:hidden flex justify-between items-center mb-6">
                            <h1 className="font-bold text-dark-900">FluxBlue</h1>
                            <button onClick={onLogout}><Icons.LogOut /></button>
                        </div>

                        {/* VIEW: OVERVIEW */}
                        {view === 'overview' && (
                            <div className="animate-fade-in">
                                <header className="mb-8">
                                    <h1 className="text-3xl font-bold text-dark-900">Visão Geral</h1>
                                    <p className="text-slate-500">Resumo financeiro em tempo real.</p>
                                </header>

                                {/* AI Insight */}
                                <AIInsight transactions={data.transactions} />

                                {/* Cards */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                        <div className="flex justify-between items-center mb-4">
                                            <span className="text-slate-400 text-sm font-semibold uppercase">Receita Total</span>
                                            <div className="bg-green-100 text-green-600 p-2 rounded-lg"><Icons.TrendingUp /></div>
                                        </div>
                                        <p className="text-3xl font-bold text-dark-900">R$ {data.transactions.filter(t=>t.type==='income').reduce((acc,t)=>acc+Number(t.amount),0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                                    </div>
                                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                        <div className="flex justify-between items-center mb-4">
                                            <span className="text-slate-400 text-sm font-semibold uppercase">Despesas</span>
                                            <div className="bg-red-100 text-red-600 p-2 rounded-lg"><Icons.TrendingDown /></div>
                                        </div>
                                        <p className="text-3xl font-bold text-dark-900">R$ {data.transactions.filter(t=>t.type==='expense').reduce((acc,t)=>acc+Number(t.amount),0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                                    </div>
                                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                        <div className="flex justify-between items-center mb-4">
                                            <span className="text-slate-400 text-sm font-semibold uppercase">Saldo Líquido</span>
                                            <div className="bg-brand-100 text-brand-600 p-2 rounded-lg"><Icons.Home /></div>
                                        </div>
                                        <p className="text-3xl font-bold text-dark-900">R$ {(data.transactions.filter(t=>t.type==='income').reduce((a,t)=>a+Number(t.amount),0) - data.transactions.filter(t=>t.type==='expense').reduce((a,t)=>a+Number(t.amount),0)).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                                    </div>
                                </div>

                                {/* Charts */}
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 mb-8">
                                    <h3 className="font-bold text-lg mb-6 text-dark-900">Fluxo de Caixa (Mensal)</h3>
                                    <div className="h-80 w-full">
                                        <ResponsiveContainer width="100%" height="100%">
                                            <AreaChart data={chartData}>
                                                <defs>
                                                    <linearGradient id="colorLucro" x1="0" y1="0" x2="0" y2="1">
                                                        <stop offset="5%" stopColor="#0ea5e9" stopOpacity={0.8}/>
                                                        <stop offset="95%" stopColor="#0ea5e9" stopOpacity={0}/>
                                                    </linearGradient>
                                                </defs>
                                                <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
                                                <XAxis dataKey="name" stroke="#94a3b8" />
                                                <YAxis stroke="#94a3b8" />
                                                <Tooltip contentStyle={{borderRadius: '12px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)'}} />
                                                <Area type="monotone" dataKey="lucro" stroke="#0ea5e9" fillOpacity={1} fill="url(#colorLucro)" name="Lucro Líquido" />
                                                <Line type="monotone" dataKey="receita" stroke="#22c55e" strokeWidth={2} dot={false} name="Receitas" />
                                                <Line type="monotone" dataKey="despesa" stroke="#ef4444" strokeWidth={2} dot={false} name="Despesas" />
                                            </AreaChart>
                                        </ResponsiveContainer>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* VIEW: FINANCES */}
                        {view === 'finances' && (
                            <div className="animate-fade-in">
                                <header className="mb-8 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                    <div>
                                        <h1 className="text-3xl font-bold text-dark-900">Lançamentos</h1>
                                        <p className="text-slate-500">Adicione receitas, despesas e dívidas.</p>
                                    </div>
                                    <div className="bg-white p-1 rounded-xl border border-slate-200 flex">
                                        <button onClick={() => setFormType('income')} className={`px-4 py-2 rounded-lg text-sm font-bold transition ${formType === 'income' ? 'bg-green-500 text-white shadow-md' : 'text-slate-500 hover:bg-slate-50'}`}>Receita</button>
                                        <button onClick={() => setFormType('expense')} className={`px-4 py-2 rounded-lg text-sm font-bold transition ${formType === 'expense' ? 'bg-red-500 text-white shadow-md' : 'text-slate-500 hover:bg-slate-50'}`}>Despesa</button>
                                    </div>
                                </header>

                                {/* Form */}
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 mb-8">
                                    <form onSubmit={handleAddTransaction} className="grid grid-cols-1 md:grid-cols-12 gap-4 items-end">
                                        <div className="md:col-span-4">
                                            <label className="block text-xs font-bold text-slate-500 mb-1">Descrição</label>
                                            <input required type="text" className="w-full bg-slate-50 border border-slate-200 rounded-lg px-4 py-3 outline-none" placeholder="Ex: Cliente X ou Conta de Luz" value={desc} onChange={e => setDesc(e.target.value)} />
                                        </div>
                                        <div className="md:col-span-3">
                                            <label className="block text-xs font-bold text-slate-500 mb-1">Valor Total (R$)</label>
                                            <input required type="number" step="0.01" className="w-full bg-slate-50 border border-slate-200 rounded-lg px-4 py-3 outline-none" placeholder="0.00" value={amount} onChange={e => setAmount(e.target.value)} />
                                        </div>
                                        <div className="md:col-span-3 flex items-center gap-2 h-full pb-2">
                                            <input type="checkbox" id="installments" checked={hasInstallments} onChange={e => setHasInstallments(e.target.checked)} className="w-5 h-5 rounded text-brand-600 focus:ring-brand-500" />
                                            <label htmlFor="installments" className="text-sm text-slate-700 cursor-pointer select-none">Parcelado?</label>
                                            
                                            {hasInstallments && (
                                                <input type="number" min="2" max="48" className="w-20 bg-slate-50 border border-slate-200 rounded-lg px-2 py-1 text-sm outline-none" value={installments} onChange={e => setInstallments(e.target.value)} />
                                            )}
                                        </div>
                                        <div className="md:col-span-2">
                                            <button type="submit" className={`w-full font-bold py-3 rounded-lg text-white transition shadow-lg ${formType === 'income' ? 'bg-green-500 hover:bg-green-600 shadow-green-200' : 'bg-red-500 hover:bg-red-600 shadow-red-200'}`}>Adicionar</button>
                                        </div>
                                    </form>
                                </div>

                                {/* Table */}
                                <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                                    <table className="w-full text-left">
                                        <thead className="bg-slate-50 border-b border-slate-200">
                                            <tr>
                                                <th className="p-4 text-xs font-bold text-slate-500 uppercase">Data</th>
                                                <th className="p-4 text-xs font-bold text-slate-500 uppercase">Descrição</th>
                                                <th className="p-4 text-xs font-bold text-slate-500 uppercase">Categoria</th>
                                                <th className="p-4 text-xs font-bold text-slate-500 uppercase">Valor</th>
                                                <th className="p-4 text-xs font-bold text-slate-500 uppercase text-right">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {data.transactions.slice().reverse().map(t => (
                                                <tr key={t.id} className="hover:bg-slate-50 transition">
                                                    <td className="p-4 text-sm text-slate-600 font-mono">{new Date(t.date).toLocaleDateString('pt-BR')}</td>
                                                    <td className="p-4 font-medium text-dark-900">{t.desc}</td>
                                                    <td className="p-4"><span className="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded border border-slate-200">{t.category}</span></td>
                                                    <td className={`p-4 font-bold ${t.type === 'income' ? 'text-green-600' : 'text-red-600'}`}>
                                                        {t.type === 'expense' ? '-' : '+'} R$ {Number(t.amount).toLocaleString('pt-BR', {minimumFractionDigits: 2})}
                                                    </td>
                                                    <td className="p-4 text-right">
                                                        <button onClick={() => handleDelete(t.id)} className="text-slate-400 hover:text-red-500 transition"><Icons.Trash /></button>
                                                    </td>
                                                </tr>
                                            ))}
                                            {data.transactions.length === 0 && (
                                                <tr><td colSpan="5" className="p-8 text-center text-slate-400">Nenhum lançamento encontrado.</td></tr>
                                            )}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* VIEW: FILES (GED) */}
                        {view === 'files' && (
                            <div className="animate-fade-in">
                                <header className="mb-8">
                                    <h1 className="text-3xl font-bold text-dark-900">Documentos</h1>
                                    <p className="text-slate-500">Gestão Eletrônica de Documentos (GED).</p>
                                </header>

                                <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                                    {/* Upload Area */}
                                    <div className="md:col-span-1">
                                        <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 text-center h-full flex flex-col justify-center items-center border-dashed border-2 border-brand-200 hover:border-brand-500 transition-colors group">
                                            <div className="bg-brand-50 p-4 rounded-full text-brand-500 mb-4 group-hover:scale-110 transition">
                                                <Icons.Upload />
                                            </div>
                                            <h3 className="font-bold text-dark-900 mb-2">Upload de Arquivo</h3>
                                            <p className="text-sm text-slate-500 mb-6 px-4">Arraste boletos, extratos (OFX/PDF) ou comprovantes aqui.</p>
                                            <label className="bg-brand-600 text-white px-6 py-2 rounded-lg cursor-pointer hover:bg-brand-700 font-bold shadow-lg shadow-brand-200 transition">
                                                Selecionar
                                                <input type="file" className="hidden" onChange={handleFileUpload} />
                                            </label>
                                            <p className="text-xs text-slate-400 mt-4">Máx: 5MB (Simulado)</p>
                                        </div>
                                    </div>

                                    {/* File List */}
                                    <div className="md:col-span-2 space-y-4">
                                        <h3 className="font-bold text-slate-700">Arquivos Recentes</h3>
                                        {data.uploads.slice().reverse().map(f => (
                                            <div key={f.id} className="bg-white p-4 rounded-xl border border-slate-100 flex items-center justify-between shadow-sm hover:shadow-md transition">
                                                <div className="flex items-center gap-4">
                                                    <div className="bg-slate-100 p-3 rounded-lg text-slate-500"><Icons.FileText /></div>
                                                    <div>
                                                        <h4 className="font-bold text-dark-900 text-sm">{f.name}</h4>
                                                        <p className="text-xs text-slate-400">{new Date(f.date).toLocaleDateString()} • {(f.size/1024).toFixed(1)} KB</p>
                                                    </div>
                                                </div>
                                                <span className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded font-bold">Arquivado</span>
                                            </div>
                                        ))}
                                        {data.uploads.length === 0 && (
                                            <div className="text-center py-10 text-slate-400 border border-slate-100 rounded-xl">Nenhum documento arquivado.</div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                    </main>
                </div>
            );
        };

        const App = () => {
            const [session, setSession] = useState(null);

            useEffect(() => { ClientSystem.init(); }, []);

            return session 
                ? <Dashboard user={session.email} license={session.license} onLogout={() => setSession(null)} />
                : <LoginScreen onLoginSuccess={(lic, email) => setSession({ license: lic, email })} />;
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
